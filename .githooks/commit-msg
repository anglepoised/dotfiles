#!/usr/bin/env sh
set -eu

msg_file="$1"
subject="$(head -n 1 "$msg_file")"

# Allow Git-generated subjects and autosquash helpers.
case "$subject" in
  Merge\ *|Revert\ *|fixup!\ *|squash!\ *)
    exit 0
    ;;
esac

if printf '%s' "$subject" | grep -Eq '^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([^)]+\))?!?: .+'; then
  exit 0
fi

cat >&2 <<'EOF'
commit-msg: non-Conventional Commit subject detected.
Expected: type(scope): summary
Example: feat(ripgrep): add rgd helper
EOF
exit 1
