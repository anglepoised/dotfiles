# Add Homebrew-installed zsh completion functions to fpath
fpath=(/opt/homebrew/share/zsh/site-functions $fpath)

# Nicer completion
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'

# Sane zsh completion without OMZ
autoload -Uz compinit
compinit -C -d "$HOME/.zcompdump"
source "/opt/homebrew/opt/fzf-tab/share/fzf-tab/fzf-tab.zsh"

# Make history useful
HISTFILE="$HOME/.zsh_history"
HISTSIZE=100000
SAVEHIST=100000
setopt SHARE_HISTORY
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_REDUCE_BLANKS
setopt HIST_IGNORE_SPACE
setopt EXTENDED_HISTORY

# Change directories without typing `cd`
setopt autocd

# Make less not suck
export LESS='-R'
export LESSHISTFILE='-'

# Local scripts
export PATH="$HOME/.local/bin:$PATH"

# Preferred editor
export EDITOR="micro"
export VISUAL="micro"

# mise
eval "$(mise activate zsh)"

# starship
eval "$(starship init zsh)"

# zoxide
eval "$(zoxide init zsh)"

# fzf (Homebrew)
if command -v fzf >/dev/null 2>&1; then
  source <(fzf --zsh)
fi

# Custom Tailscale Alias
# This provides a permanent shortcut to the Tailscale CLI embedded in the GUI app.
alias tailscale='/Applications/Tailscale.app/Contents/MacOS/Tailscale'

# exif Alias
# Keeps my image file naming consistent
alias exif='exiftool "-FileName<CreateDate" -d "%Y-%m-%d_%H-%M-%S-%%f.%%e"'

# ls/eza aliases (prefer eza when available)
if command -v eza >/dev/null 2>&1; then
  alias l='eza --group-directories-first --icons=auto'
  alias la='eza -a --group-directories-first --icons=auto'
  alias ll='eza -la --git --group-directories-first --icons=auto --time-style=long-iso'
  alias lt='eza --tree -a -L 2 --group-directories-first --icons=auto'
else
  alias ll='ls -alF'
  alias la='ls -A'
  alias l='ls -CF'
fi
alias g='git'

# lazygit
alias lg='lazygit'

# bat
alias b='bat'

# ripgrep
if command -v rg >/dev/null 2>&1; then
  export RIPGREP_CONFIG_PATH="${XDG_CONFIG_HOME:-$HOME/.config}/ripgrep/config"
  alias rgh='rg --hidden --glob "!.git"'
  rgd() {
    rg --json "$@" | delta
  }
fi

# fd
if command -v fd >/dev/null 2>&1; then
  alias f='fd'
  alias fdf='fd --type f'
  alias fdd='fd --type d'
  alias fdh='fd --hidden --no-ignore-vcs'
fi

# fd + bat + fzf file picker
if command -v fd >/dev/null 2>&1 && command -v fzf >/dev/null 2>&1 && command -v bat >/dev/null 2>&1; then
  fp() {
    fd --type f --hidden --follow --exclude .git \
      | fzf --preview 'bat --style=numbers --color=always --line-range :200 {}' \
            --preview-window 'right,60%,border-left'
  }
fi

# git-absorb
if command -v git-absorb >/dev/null 2>&1; then
  alias gabs='git absorb'
  alias gabr='git absorb --and-rebase'
fi

# go home
alias home='cd ~'

# reload shell
alias reload='source "$HOME/.zshrc"'
